{% extends 'base.html.twig' %}

{% block title %}GÃ©rer les utilisateurs
{% endblock %}


{% block main %}
	<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
		<a href="{{ path('dashboard') }}" class="btn btn-secondary">â† Retour au Dashboard</a>
		<h1 class="mb-0 text-danger">ğŸ‘¥ GÃ©rer les utilisateurs</h1>
	</div>

	{% if users is not empty %}
		<div class="table-responsive">
			<table class="table table-striped table-hover align-middle">
				<thead class="table-dark">
					<tr>
						<th>ID</th>
						<th>PrÃ©nom</th>
						<th>Nom</th>
						<th>Email</th>
						<th>RÃ´les</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for user in users %}
						<tr>
							<td><strong>{{ user.id }}</strong></td>
							<td>{{ user.firstName }}</td>
							<td>{{ user.lastName }}</td>
							<td>{{ user.email }}</td>
							<td>
								{% if user.roles %}
									{% for role in user.roles %}
										{% if role == 'ROLE_ADMIN' %}
											<span class="badge bg-danger">Admin</span>
										{% else %}
											<span class="badge bg-success">{{ role }}</span>
										{% endif %}
									{% endfor %}
								{% else %}
									<span class="badge bg-secondary">Utilisateur</span>
								{% endif %}
							</td>
							<td class="d-flex gap-2 flex-wrap">
								<form method="POST" action="{{ path('user_role', {'id': user.id}) }}" class="d-inline">
									{% if 'ROLE_ADMIN' in user.roles %}
										<button type="submit" name="role" value="ROLE_USER" class="btn btn-sm btn-warning" title="RÃ©trograder en utilisateur">ğŸ‘¤ RÃ©trograder</button>
									{% else %}
										<button type="submit" name="role" value="ROLE_ADMIN" class="btn btn-sm btn-success" title="Promouvoir en admin">â­ Promouvoir Admin</button>
									{% endif %}
								</form>
								{% if user.id != app.user.id %}
									<a href="{{ path('delete_user', {'id': user.id}) }}" class="btn btn-sm btn-danger" onclick="return confirm('ÃŠtes-vous sÃ»r de vouloir supprimer cet utilisateur ?')">ğŸ—‘ï¸ Supprimer</a>
								{% else %}
									<span class="btn btn-sm btn-secondary disabled">(Votre compte)</span>
								{% endif %}
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	{% else %}
		<div class="alert alert-warning" role="alert">Aucun utilisateur pour le moment.</div>
	{% endif %}

	<div class="mt-4 text-end">
		<small class="text-light-emphasis">Total: <strong>{{ users|length }}</strong> utilisateur(s)</small>
	</div>

{% endblock %}

