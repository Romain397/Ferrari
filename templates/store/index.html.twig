{% extends 'base.html.twig' %}

{% block title %}Store
{% endblock %}

{% block main %}
	<h1 class="text-danger mb-4">Store</h1>
	<div class="row g-4 store-layout">
		<div class="col-12 col-xl-8">
			<div class="row">
				{% for product in products %}
					<div class="col-12 col-sm-6 col-lg-4 mb-4">
						<div class="card h-100 shadow-sm">
							{% if product.image %}
								<img src="{{ asset(product.image) }}" class="card-img-top store-product-image" alt="{{ product.name }}">
							{% endif %}
							<div class="card-body d-flex flex-column">
								<h5 class="card-title text-danger">{{ product.name }}</h5>
								<p class="card-text flex-grow-1">{{ product.description|slice(0,50) ~ '...' }}</p>
								<p class="text-danger fw-bold mb-3">{{ product.price }} €</p>
								<button
									type="button"
									class="btn btn-danger w-100 js-add-to-cart"
									data-product-id="{{ product.id }}"
									data-product-name="{{ product.name }}"
									data-product-price="{{ product.price }}"
									data-product-image="{{ product.image ? asset(product.image) : '' }}"
								>
									Ajouter au panier
								</button>
							</div>
						</div>
					</div>
				{% else %}
					<p>Aucun produit pour le moment.</p>
				{% endfor %}
			</div>
		</div>

		<div class="col-12 col-xl-4">
			<div id="store-cart-panel" class="card store-sticky-cart no-lift border border-danger p-3" data-ordered="{{ app.request.query.get('ordered') ? '1' : '0' }}">
				<h4 class="text-danger mb-3">Panier</h4>

				<div id="store-cart-empty" class="alert alert-dark border border-danger mb-0" style="display:none;">
					Votre panier est vide.
				</div>

				<div id="store-cart-content" style="display:none;">
					<div id="store-cart-items" class="d-flex flex-column gap-2"></div>

					<div class="d-flex justify-content-between align-items-center mt-3 flex-wrap gap-2">
						<p class="mb-0 fs-6">
							Total:
							<strong class="text-danger" id="store-cart-total">0.00 €</strong>
						</p>
					</div>

					<form method="post" action="{{ path('cart_checkout') }}" id="store-checkout-form" class="checkout-form-inline mt-3">
						<input type="hidden" name="cart_items" id="store-cart-items-input">
						<input type="hidden" name="_token" value="{{ csrf_token('cart_checkout') }}">
						<button type="submit" class="btn btn-danger w-100">Passer la commande</button>
					</form>

					{% if not app.user %}
						<p class="mt-3 mb-0 text-warning small">
							Connexion requise pour commander.
							<a href="{{ path('app_login') }}" class="text-warning">Se connecter</a>
						</p>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
{% endblock %}
